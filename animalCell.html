




<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JCE Biology AR - World-Anchored</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
<script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

<style>
body, html { margin:0; padding:0; width:100%; height:100%; overflow:hidden; font-family:'Segoe UI',sans-serif;}
#ui-layer { position:fixed; inset:0; pointer-events:none; z-index:1000;}
.interactable-ui { pointer-events:auto; }

#overlay {
  position:fixed; inset:0;
  background:rgba(0,0,0,0.9);
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  color:white; z-index:9999; text-align:center;
}

#status-label {
  position:absolute; left:10px; top:10px;
  padding:6px 12px;
  background:rgba(0,0,0,0.8);
  color:#00ff00;
  border-radius:20px;
  font-size:11px;
  border:1px solid #00ff00;
}

#gps-info {
  position:absolute; left:10px; top:55px;
  padding:10px;
  background:rgba(0,0,0,0.85);
  color:#00ff00;
  border-radius:8px;
  font-size:10px;
  display:none;
  border:1px solid #00ff00;
}

#teacher-panel {
  position:absolute; top:10px; right:10px;
  background:rgba(20,20,20,0.95);
  padding:10px;
  border-radius:12px;
  width:160px;
  border:2px solid #800000;
}

.teacher-btn {
  width:100%; margin:4px 0;
  padding:10px;
  border-radius:8px;
  background:#800000;
  color:white;
  border:1px solid orange;
  font-size:10px;
  font-weight:bold;
}

#help-bar {
  position:absolute; bottom:30px; left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.85);
  color:white;
  padding:15px 25px;
  border-radius:30px;
  width:85%;
  text-align:center;
  border:1px solid #00ff00;
  font-size:13px;
  pointer-events:auto;
}
</style>
</head>

<body>

<div id="overlay" class="interactable-ui">
  <h2>JCE Biology AR</h2>
  <p>This app requires camera and motion access</p>
  <button class="teacher-btn" style="width:200px;font-size:16px" onclick="startApp()"> START AR</button>
</div>

<div id="ui-layer">
  <div id="status-label">MODE: HIRO MARKER</div>

  <div id="gps-info">
    <b style="color:white"> GPS LIVE DATA</b><br>
    Distance: <span id="gps-dist">---</span> m<br>
    Lat: <span id="curr-lat">0.0000</span><br>
    Lon: <span id="curr-lon">0.0000</span>
  </div>

  <div id="teacher-panel" class="interactable-ui">
    <button class="teacher-btn" onclick="cycleMode()"> SWITCH MODE</button>
    <button id="gps-action-btn" class="teacher-btn" style="display:none;background:#004d00" onclick="dropAtCurrentLocation()"> ANCHOR HERE</button>
    <button class="teacher-btn" onclick="adjustScale(1.2)"> SCALE</button>
    <button class="teacher-btn" onclick="adjustScale(0.8)"> SCALE</button>
  </div>

  <div id="help-bar" onclick="placeFreeRoam()">Tap to place object</div>
</div>

<a-scene embedded
  vr-mode-ui="enabled:false"
  arjs="sourceType:webcam;debugUIEnabled:false"
  device-orientation-permission-ui="enabled:true">

  <a-camera gps-camera rotation-reader></a-camera>

  <a-entity id="cellTemplate" visible="false">
    <a-sphere radius="2" material="color:#4cc9f0;opacity:0.2;transparent:true"></a-sphere>
    <a-sphere radius="0.5" color="#7209b7"></a-sphere>
    <a-text value="Animal Cell" position="0 2.5 0" align="center" look-at="[gps-camera]" color="white"></a-text>
  </a-entity>

  <a-marker preset="hiro" id="markerTarget">
    <a-entity id="markerContainer" scale="0.4 0.4 0.4"></a-entity>
  </a-marker>

  <a-entity id="gpsTarget" gps-entity-place="latitude:0;longitude:0" visible="false">
    <a-entity id="gpsContainer" scale="20 20 20"></a-entity>
  </a-entity>

  <a-entity id="freeRoamContainer" visible="false"></a-entity>
</a-scene>

<script>
const modes = ["HIRO MARKER","GPS ANCHOR","FREE ROAM"];
let modeIndex = 0;
let gpsReady = false;

const statusLabel = document.getElementById("status-label");
const gpsInfo = document.getElementById("gps-info");
const gpsActionBtn = document.getElementById("gps-action-btn");
const helpBar = document.getElementById("help-bar");
const gpsDist = document.getElementById("gps-dist");
const currLat = document.getElementById("curr-lat");
const currLon = document.getElementById("curr-lon");

function startApp() {
  document.getElementById("overlay").style.display="none";
  navigator.geolocation.getCurrentPosition(
    () => gpsReady = true,
    () => alert("GPS disabled")
  );
}

window.onload = () => {
  const tpl = document.getElementById("cellTemplate");
  ["markerContainer","gpsContainer","freeRoamContainer"].forEach(id=>{
    const c = tpl.cloneNode(true);
    c.setAttribute("visible","true");
    document.getElementById(id).appendChild(c);
  });

  window.addEventListener("gps-camera-update-position", e=>{
    if(e.detail?.position){
      currLat.textContent = e.detail.position.latitude.toFixed(4);
      currLon.textContent = e.detail.position.longitude.toFixed(4);
    }
  });

  document.getElementById("gpsTarget")
    .addEventListener("gps-entity-place-update-position", e=>{
      if(e.detail?.distance){
        gpsDist.textContent = e.detail.distance.toFixed(1);
      }
    });
};

function cycleMode(){
  modeIndex = (modeIndex+1)%modes.length;
  const m = modes[modeIndex];

  statusLabel.innerText = "MODE: "+m;
  document.getElementById("markerTarget").setAttribute("visible", m==="HIRO MARKER");
  document.getElementById("gpsTarget").setAttribute("visible", m==="GPS ANCHOR");
  gpsInfo.style.display = m==="GPS ANCHOR"?"block":"none";
  gpsActionBtn.style.display = m==="GPS ANCHOR"?"block":"none";
  document.getElementById("freeRoamContainer").object3D.visible = false;

  helpBar.innerText =
    m==="FREE ROAM"?"Tap to place object":
    m==="HIRO MARKER"?"Point camera at Hiro Marker":
    "Walk outside then tap ANCHOR";
}

function dropAtCurrentLocation(){
  if(!gpsReady) return alert("GPS not ready");
  navigator.geolocation.getCurrentPosition(p=>{
    document.getElementById("gpsTarget")
      .setAttribute("gps-entity-place",{
        latitude:p.coords.latitude,
        longitude:p.coords.longitude
      });
  });
}

function placeFreeRoam(){
  if(modes[modeIndex]!=="FREE ROAM") return;
  const c = document.getElementById("freeRoamContainer");
  c.object3D.position.set(0,-1.2,-3);
  c.object3D.visible = true;
}

function adjustScale(f){
  const id =
    modes[modeIndex]==="HIRO MARKER"?"markerContainer":
    modes[modeIndex]==="GPS ANCHOR"?"gpsContainer":"freeRoamContainer";
  const el = document.getElementById(id);
  const s = el.getAttribute("scale")||{x:1,y:1,z:1};
  el.setAttribute("scale",{x:s.x*f,y:s.y*f,z:s.z*f});
}
</script>

</body>
</html>