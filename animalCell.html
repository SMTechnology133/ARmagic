



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JCE Animal Cell AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        
        /* Responsive Teacher Panel */
        #teacher-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(68, 68, 68, 0.9);
            padding: 10px;
            border-radius: 12px;
            width: 140px; /* Slimmer for mobile */
            color: orange;
            border: 1px solid orange;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .teacher-btn {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            background: #800000;
            color: orange;
            border: 1px solid orange;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
        }

        #help-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(128, 0, 0, 0.85);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            width: 80%;
            text-align: center;
            border: 1px solid orange;
            z-index: 1000;
            pointer-events: none;
        }

        #status-label {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: #00ff00;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 10px;
            z-index: 1000;
        }
    </style>
</head>

<body>

<div id="status-label">MODE: HIRO MARKER</div>

<div id="teacher-panel">
    <div style="text-align:center; font-size: 12px; margin-bottom: 5px;"> TEACHER</div>
    <button class="teacher-btn" onclick="toggleARMode()"> GPS/MARKER</button>
    <button class="teacher-btn" onclick="toggleVoice()"> VOICE</button>
    <button class="teacher-btn" onclick="toggleQuiz()"> QUIZ</button>
</div>

<div id="help-bar">
    <span id="instruction">Point at HIRO marker to start</span>
</div>

<a-scene embedded vr-mode-ui="enabled:false" arjs="sourceType: webcam; debugUIEnabled: false;">
    
    <a-camera id="cam" cursor="rayOrigin: mouse; fuse: false" raycaster="objects: .clickable">
        <a-plane id="infoPanel" position="0 -0.5 -1.5" width="2" height="0.6" color="#222" visible="false">
            <a-text id="infoText" color="white" align="center" width="1.8" position="0 0 0.01"></a-text>
        </a-plane>

        <a-plane id="quizPanel" position="0 0 -1.6" width="2.2" height="1.8" color="#fff3e0" visible="false">
            <a-text id="quizQ" position="0 0.6 0.01" color="black" width="2" align="center"></a-text>
            <a-text id="opt0" class="clickable" position="0 0.1 0.01" color="maroon" align="center" width="1.8"></a-text>
            <a-text id="opt1" class="clickable" position="0 -0.3 0.01" color="maroon" align="center" width="1.8"></a-text>
            <a-text id="opt2" class="clickable" position="0 -0.7 0.01" color="maroon" align="center" width="1.8"></a-text>
        </a-plane>
    </a-camera>

    <a-entity id="cellModel" visible="false">
        <a-sphere class="clickable" radius="1" material="color:#ffddc1; opacity:0.2; transparent:true" data-title="Cell Membrane" data-desc="The outer layer that controls what enters and leaves the cell."></a-sphere>
        <a-sphere class="clickable" radius="0.3" color="purple" position="0 0 0" data-title="Nucleus" data-desc="The brain of the cell containing DNA."></a-sphere>
        <a-sphere class="clickable" radius="0.15" color="orange" position="0.5 0.2 0.4" data-title="Mitochondrion" data-desc="The powerhouse of the cell providing energy."></a-sphere>
        <a-box class="clickable" width="0.4" height="0.1" depth="0.3" color="green" position="-0.4 0.3 -0.2" data-title="Golgi Body" data-desc="Packages proteins for transport."></a-box>
    </a-entity>

    <a-marker preset="hiro" id="cellMarker">
        <a-entity id="markerContainer"></a-entity>
    </a-marker>

    <a-entity id="cellGPS" gps-entity-place="latitude:-13.9626; longitude:33.7741" visible="false" scale="10 10 10">
        <a-entity id="gpsContainer"></a-entity>
    </a-entity>

</a-scene>

<script>
    let voiceOn = true;
    let quizActive = false;
    let gpsMode = false;
    let qIndex = 0;
    let score = 0;

    const synth = window.speechSynthesis;

    // Fix for A-Frame click handling
    function initApp() {
        const cell = document.getElementById('cellModel');
        const markerCont = document.getElementById('markerContainer');
        const gpsCont = document.getElementById('gpsContainer');

        // Clone the cell into both containers
        markerCont.appendChild(cell.cloneNode(true)).setAttribute('visible', 'true');
        gpsCont.appendChild(cell.cloneNode(true)).setAttribute('visible', 'true');

        // Global Event Listener for Organelles
        document.querySelectorAll('.clickable').forEach(el => {
            el.addEventListener('click', (e) => {
                if (quizActive) {
                    handleQuizClick(e.target.id);
                    return;
                }
                const title = e.target.dataset.title;
                const desc = e.target.dataset.desc;
                if(title) {
                    showInfo(title, desc);
                }
            });
        });

        // Specific Quiz Option Listeners
        ['opt0', 'opt1', 'opt2'].forEach(id => {
            document.getElementById(id).addEventListener('click', () => {
                const choice = parseInt(id.replace('opt', ''));
                checkAnswer(choice);
            });
        });
    }

    function showInfo(title, desc) {
        const panel = document.getElementById('infoPanel');
        const text = document.getElementById('infoText');
        text.setAttribute('value', `${title}\n\n${desc}`);
        panel.setAttribute('visible', true);
        if(voiceOn) {
            const utter = new SpeechSynthesisUtterance(desc);
            synth.speak(utter);
        }
        setTimeout(() => panel.setAttribute('visible', false), 4000);
    }

    function toggleARMode() {
        gpsMode = !gpsMode;
        document.getElementById("cellMarker").setAttribute("visible", !gpsMode);
        document.getElementById("cellGPS").setAttribute("visible", gpsMode);
        document.getElementById("status-label").innerText = gpsMode ? "MODE: GPS LOCATION" : "MODE: HIRO MARKER";
        document.getElementById("instruction").innerText = gpsMode ? "Look around your physical location" : "Point at HIRO marker";
    }

    function toggleVoice() { voiceOn = !voiceOn; alert("Voice " + (voiceOn ? "ON" : "OFF")); }

    function toggleQuiz() {
        quizActive = !quizActive;
        document.getElementById('quizPanel').setAttribute('visible', quizActive);
        if(quizActive) { resetQuiz(); }
    }

    function resetQuiz() {
        qIndex = 0; score = 0;
        updateQuizUI();
    }

    const questions = [
        {q:"Control center of cell?", o:["Nucleus","Ribosome","Vacuole"], a:0},
        {q:"Energy producer?", o:["Golgi","Mitochondrion","Nucleus"], a:1},
        {q:"Controls entry & exit?", o:["Cytoplasm","Membrane","Nucleus"], a:1}
    ];

    function updateQuizUI() {
        if (qIndex >= questions.length) {
            document.getElementById("quizQ").setAttribute("value", `Finished!\nScore: ${score}/${questions.length}`);
            return;
        }
        const q = questions[qIndex];
        document.getElementById("quizQ").setAttribute("value", q.q);
        q.o.forEach((txt, i) => {
            document.getElementById("opt" + i).setAttribute("value", txt);
        });
    }

    function checkAnswer(i) {
        if (qIndex >= questions.length) return;
        if (i === questions[qIndex].a) score++;
        qIndex++;
        updateQuizUI();
    }

    window.onload = initApp;
</script>
</body>
</html>
