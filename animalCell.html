<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JCE Animal Cell AR – Hybrid GPS & Marker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<style>
body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: maroon;
}

/* Force AR scene behind UI */
a-scene {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1;
}

/* UI overlays */
#teacher-panel, #help-bar, #status-label {
    z-index: 9999;
    pointer-events: auto;
}

#teacher-panel {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #444;
    padding: 12px;
    border-radius: 15px;
    width: 180px;
    color: orange;
    border: 1px solid orange;
}

.teacher-btn {
    width: 100%;
    margin: 6px 0;
    padding: 10px;
    border-radius: 20px;
    background: maroon;
    color: orange;
    border: 1px solid orange;
    font-weight: bold;
}

#help-bar {
    position: fixed;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(128,0,0,0.9);
    color: orange;
    padding: 12px 22px;
    border-radius: 40px;
    width: 85%;
    text-align: center;
    border: 2px solid orange;
}

#status-label {
    position: fixed;
    top: 10px;
    left: 10px;
    background: #444;
    color: orange;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    border: 1px solid orange;
}
</style>
</head>

<body>

<div id="status-label">Mode: HIRO MARKER</div>

<div id="teacher-panel">
<h4 style="text-align:center;margin-top:0"> Teacher</h4>
<button class="teacher-btn" onclick="toggleARMode()"> Switch to GPS</button>
<button class="teacher-btn" onclick="toggleVoice()"> Voice ON/OFF</button>
<button class="teacher-btn" onclick="toggleQuiz()"> Quiz ON/OFF</button>
<button class="teacher-btn" onclick="resetQuiz()"> Reset Quiz</button>
</div>

<div id="help-bar">
<span id="instruction">Point at HIRO marker to view the animal cell, move outside for GPS location</span>
</div>

<a-scene
    embedded
    vr-mode-ui="enabled:false"
    arjs="sourceType: webcam; debugUIEnabled: false;">

<a-camera id="cam" cursor="rayOrigin: mouse">

    <!-- INFO PANEL -->
    <a-plane id="infoPanel"
        position="0 -0.6 -1.4"
        width="2.3"
        height="0.9"
        color="#222"
        visible="false"
        look-at="#cam">
        <a-text id="infoText" color="white" align="center" width="2"></a-text>
    </a-plane>

    <!-- QUIZ PANEL -->
    <a-plane id="quizPanel"
        position="0 0.5 -1.6"
        width="2.6"
        height="2"
        color="#fff3e0"
        visible="false"
        look-at="#cam">

        <a-text id="quizQ" position="0 0.75 0.1" color="black" width="2.4" align="center"></a-text>
        <a-text id="opt0" position="0 0.2 0.1" color="maroon" align="center" width="2.2"></a-text>
        <a-text id="opt1" position="0 -0.2 0.1" color="maroon" align="center" width="2.2"></a-text>
        <a-text id="opt2" position="0 -0.6 0.1" color="maroon" align="center" width="2.2"></a-text>
        <a-text id="scoreText" position="0 -1.1 0.1" color="blue" align="center"></a-text>
    </a-plane>

</a-camera>

<!-- MARKER MODE -->
<a-marker preset="hiro" id="cellMarker">
    <a-entity id="markerContent"></a-entity>
</a-marker>

<!-- GPS MODE -->
<a-entity id="cellGPS"
    gps-entity-place="latitude:-13.9626; longitude:33.7741"
    scale="8 8 8"
    visible="false">
    <a-entity id="gpsContent"></a-entity>
</a-entity>

</a-scene>

<script>
let voiceOn = true;
let quizActive = false;
let gpsMode = false;
let qIndex = 0;
let score = 0;

const synth = window.speechSynthesis;
const utter = new SpeechSynthesisUtterance();

function speak(text) {
    if (!voiceOn) return;
    synth.cancel();
    utter.text = text;
    synth.speak(utter);
}

const cellHTML = `
<a-sphere radius="1" material="color:#ffddc1; opacity:0.25; transparent:true"></a-sphere>

<a-sphere radius="1.05" wireframe="true" opacity="0.2"
data-title="Cell Membrane"
data-desc="Controls movement in and out of the cell"></a-sphere>

<a-sphere radius="0.3" color="purple"
data-title="Nucleus"
data-desc="Controls all cell activities"></a-sphere>

<a-sphere position="0.6 0.2 0.4" radius="0.15" color="orange"
data-title="Mitochondrion"
data-desc="Produces energy"></a-sphere>

<a-box position="-0.5 0.4 -0.3" width="0.4" height="0.1" depth="0.3" color="green"
data-title="Golgi Body"
data-desc="Packages proteins"></a-box>
`;

const questions = [
{q:"Control center of cell?", o:["Nucleus","Ribosome","Vacuole"], a:0},
{q:"Energy producer?", o:["Golgi","Mitochondrion","Nucleus"], a:1},
{q:"Protein synthesis?", o:["Ribosome","Membrane","Vacuole"], a:0},
{q:"Controls entry & exit?", o:["Cytoplasm","Membrane","Nucleus"], a:1},
{q:"Packages proteins?", o:["Golgi","Mitochondrion","Ribosome"], a:0}
];

function toggleARMode() {
    gpsMode = !gpsMode;
    document.getElementById("cellMarker").setAttribute("visible", !gpsMode);
    document.getElementById("cellGPS").setAttribute("visible", gpsMode);
    document.getElementById("status-label").innerText =
        gpsMode ? "Mode: GPS LOCATION" : "Mode: HIRO MARKER";
}

function toggleVoice() {
    voiceOn = !voiceOn;
    alert("Voice " + (voiceOn ? "ON" : "OFF"));
}

function toggleQuiz() {
    quizActive = !quizActive;
    showQuiz();
}

function resetQuiz() {
    qIndex = 0;
    score = 0;
    showQuiz();
}

function showQuiz() {
    const panel = document.getElementById("quizPanel");
    if (!quizActive) {
        panel.setAttribute("visible", false);
        return;
    }

    if (qIndex >= questions.length) {
        document.getElementById("quizQ").setAttribute("value",
        `Finished! Score ${score}/${questions.length}`);
        speak("Quiz completed");
        return;
    }

    panel.setAttribute("visible", true);
    const q = questions[qIndex];
    document.getElementById("quizQ").setAttribute("value", q.q);
    speak(q.q);

    q.o.forEach((txt, i) => {
        const opt = document.getElementById("opt"+i);
        opt.setAttribute("value", txt);
        opt.onclick = () => {
            if (i === q.a) score++;
            qIndex++;
            showQuiz();
        };
    });

    document.getElementById("scoreText")
        .setAttribute("value", `Score: ${score}`);
}

function init() {
    markerContent.innerHTML = cellHTML;
    gpsContent.innerHTML = cellHTML;

    setTimeout(() => {
        document.querySelectorAll("[data-title]").forEach(el => {
            el.addEventListener("click", () => {
                if (quizActive) return;
                infoText.setAttribute("value",
                    el.dataset.title + "\n\n" + el.dataset.desc);
                infoPanel.setAttribute("visible", true);
                speak(el.dataset.desc);
                setTimeout(() => infoPanel.setAttribute("visible", false), 4000);
            });
        });
    }, 1000);
}

window.onload = init;
</script>

</body>
</html>